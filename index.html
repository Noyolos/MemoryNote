<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afterglow</title>
    <style>
        :root {
            --primary: #fff;
            --accent: #888;
            --bg-glass: rgba(10, 10, 10, 0.85);
            --border-glass: rgba(255, 255, 255, 0.15);
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: #050505;
            font-family: 'Courier New', Courier, monospace;
            color: var(--primary);
            user-select: none;
        }
        #canvas-container { width: 100vw; height: 100vh; display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* --- UI æ¶æ§‹ --- */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
        }

        /* å·¦å´é¢æ¿ - æå‡å±¤ç´šä¸¦ç¢ºä¿å¯é»æ“Š */
        #control-panel {
            position: absolute; top: 30px; left: 30px; 
            pointer-events: auto; /* é—œéµï¼šå…è¨±é»æ“?*/
            z-index: 100; 
            
            display: flex; flex-direction: column; gap: 15px; width: 220px;
            background: var(--bg-glass); padding: 20px;
            border: 1px solid var(--border-glass);
            backdrop-filter: blur(12px); border-radius: 8px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            transition: opacity 0.5s, transform 0.5s;
        }
        
        /* å³å´ç‰¹æ•ˆæ§åˆ¶é¢æ¿ */
        #settings-toggle {
            position: absolute; top: 30px; right: 30px; 
            pointer-events: auto; z-index: 100;
            
            width: 40px; height: 40px; border-radius: 8px;
            background: var(--bg-glass); border: 1px solid var(--border-glass);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s;
            backdrop-filter: blur(12px); color: var(--primary);
        }
        #settings-toggle:hover { background: rgba(255,255,255,0.1); border-color: var(--primary); }
        #settings-toggle.active { background: var(--primary); color: #000; }

        #effect-panel {
            position: absolute; top: 80px; right: 30px; width: 260px; 
            pointer-events: auto; z-index: 90;
            
            background: var(--bg-glass); border: 1px solid var(--border-glass);
            backdrop-filter: blur(15px); border-radius: 12px;
            padding: 20px; display: flex; flex-direction: column; gap: 15px; /* ç¨å¾®ç¸®å°é–“è· */
            transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            
            /* --- æ»¾å‹•æ¢è¨­ç½?--- */
            max-height: calc(100vh - 120px); /* é™åˆ¶æœ€å¤§é«˜åº¦ï¼Œç¢ºä¿åº•éƒ¨ä¸è¢«åˆ‡æ–· */
            overflow-y: auto; /* è¶…å‡ºé«˜åº¦æ™‚è‡ªå‹•é¡¯ç¤ºæ»¾å‹•æ¢ */
            overscroll-behavior: contain; /* é˜²æ­¢æ»¾å‹•é¢æ¿æ™‚é€£å¸¶æ»¾å‹•æ•´å€‹é é?*/
            
            box-shadow: -5px 0 30px rgba(0,0,0,0.5);

            /* Firefox æ»¾å‹•æ¢æ”¯æŒ?*/
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.2) transparent;
        }
        #effect-panel.open { transform: translateX(0); }

        /* Webkit (Chrome/Safari) æ»¾å‹•æ¢æ¨£å¼?*/
        #effect-panel::-webkit-scrollbar { width: 4px; }
        #effect-panel::-webkit-scrollbar-track { background: transparent; }
        #effect-panel::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }
        #effect-panel::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }

        .section-title {
            font-size: 10px; color: var(--accent); letter-spacing: 2px; text-transform: uppercase;
            border-bottom: 1px solid var(--border-glass); padding-bottom: 5px; margin-bottom: 5px;
            margin-top: 5px;
        }
        /* ç¬¬ä¸€å€‹æ¨™é¡Œä¸éœ€è¦ä¸Šé‚Šè· */
        .section-title:first-child { margin-top: 0; }

        .control-group { margin-bottom: 5px; }
        .control-label {
            display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 8px;
            font-weight: 600; letter-spacing: 0.5px;
        }
        .control-value { font-family: monospace; opacity: 0.7; font-size: 10px; }

        input[type=range] {
            -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer; pointer-events: auto;
        }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; transition: 0.2s;
        }
        input[type=range]:hover::-webkit-slider-runnable-track { background: rgba(255,255,255,0.2); }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%;
            background: var(--primary); margin-top: -5px; box-shadow: 0 0 10px rgba(255,255,255,0.5);
            border: 2px solid #000; transition: transform 0.1s;
        }
        input[type=range]:active::-webkit-slider-thumb { transform: scale(1.2); }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            border: 1px solid rgba(255, 255, 255, 0.2); color: #ccc; 
            background: rgba(255, 255, 255, 0.05); padding: 12px 0; 
            font-size: 11px; font-weight: bold; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px; width: 100%; text-align: center;
            transition: all 0.3s; flex: 1; border-radius: 4px;
            pointer-events: auto; position: relative; z-index: 10;
        }
        .btn:hover { background: rgba(255, 255, 255, 0.15); border-color: #fff; color: #fff; }
        
        .upload-btn-wrapper input[type=file] { 
            position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; height: 100%; width: 100%; z-index: 20;
        }

        .hidden { opacity: 0; pointer-events: none !important; }
        
        .nav-zone {
            position: absolute; top: 0; height: 100%; width: 10%; z-index: 12; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: background 0.3s; pointer-events: auto;
        }
        .nav-zone:hover { background: rgba(255,255,255,0.03); }
        .nav-zone.left { left: 0; } .nav-zone.right { right: 0; }
        .arrow { font-size: 30px; opacity: 0; transition: 0.3s; color: #fff; transform: scale(0.8); }
        .nav-zone:hover .arrow { opacity: 1; transform: scale(1.2); }

        #gallery-info {
            position: absolute; bottom: 40px; width: 100%; text-align: center; pointer-events: none;
            color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
        #gallery-counter { font-size: 24px; letter-spacing: 8px; font-weight: 300; margin-bottom: 5px; }
        
        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 12px; opacity: 0; pointer-events: none; z-index: 200; 
            letter-spacing: 4px; background: #000; padding: 10px 20px; border: 1px solid #fff; color: #fff;
        }

        .bg-grid {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px; pointer-events: none; z-index: 0;
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div id="loading">PROCESSING...</div>

    <div id="ui-layer">
        <!-- è¨­ç½®é–‹é—œ -->
        <div id="settings-toggle" title="Toggle Controls">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        </div>

        <!-- å³å´ç‰¹æ•ˆé¢æ¿ -->
        <div id="effect-panel">
            <div class="section-title">COLOR & LIGHT</div>
            <div class="control-group">
                <div class="control-label">Brightness <span class="control-value" id="val-brightness">1.0</span></div>
                <input type="range" id="inp-brightness" min="0" max="3" step="0.1" value="1.0">
            </div>
            <div class="control-group">
                <div class="control-label">Contrast <span class="control-value" id="val-contrast">1.0</span></div>
                <input type="range" id="inp-contrast" min="0" max="3" step="0.1" value="1.0">
            </div>
            
            <div class="section-title">PARTICLES</div>
            <div class="control-group">
                <div class="control-label">Particle Size <span class="control-value" id="val-particleSize">6.0</span></div>
                <input type="range" id="inp-particleSize" min="1" max="15" step="0.5" value="6.0">
            </div>
             <div class="control-group">
                <div class="control-label">Grid Opacity <span class="control-value" id="val-gridOpacity">0.3</span></div>
                <input type="range" id="inp-gridOpacity" min="0" max="1" step="0.1" value="0.3">
            </div>
            
            <div class="section-title">EROSION & PHYSICS</div>
            <div class="control-group">
                <div class="control-label">Erosion Speed <span class="control-value" id="val-erosionSpeed">0.2</span></div>
                <input type="range" id="inp-erosionSpeed" min="0" max="1" step="0.05" value="0.2">
            </div>
             <div class="control-group">
                <div class="control-label">Wave Amp <span class="control-value" id="val-waveAmplitude">0.05</span></div>
                <input type="range" id="inp-waveAmplitude" min="0" max="0.5" step="0.01" value="0.05">
            </div>
             <div class="control-group">
                <div class="control-label">Wave Speed <span class="control-value" id="val-waveSpeed">0.2</span></div>
                <input type="range" id="inp-waveSpeed" min="0" max="1" step="0.05" value="0.2">
            </div>
            <div class="control-group">
                <div class="control-label">Dispersion <span class="control-value" id="val-dispersion">1.0</span></div>
                <input type="range" id="inp-dispersion" min="0" max="3" step="0.1" value="1.0">
            </div>
            <div class="control-group">
                <div class="control-label">Roughness <span class="control-value" id="val-edgeRoughness">1.0</span></div>
                <input type="range" id="inp-edgeRoughness" min="0" max="3" step="0.1" value="1.0">
            </div>
             <div class="control-group">
                <div class="control-label">Safe Area <span class="control-value" id="val-stableRadius">0.42</span></div>
                <input type="range" id="inp-stableRadius" min="0.1" max="0.5" step="0.01" value="0.42">
            </div>

            <div class="section-title">LAYOUT</div>
            <div class="control-group">
                <div class="control-label">Memory Gap <span class="control-value" id="val-galleryGap">2.2</span></div>
                <input type="range" id="inp-galleryGap" min="1.5" max="5.0" step="0.1" value="2.2">
            </div>
        </div>

        <!-- å·¦å´é¢æ¿ -->
        <div id="control-panel">
            <div style="font-size: 10px; color: #888; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 5px;">AFTERGLOW WORKSTATION</div>
            <div class="action-row">
                <div class="btn upload-btn-wrapper">
                    <span>Upload</span>
                    <input type="file" id="fileInput" accept="image/*" />
                </div>
                <button id="archiveBtn" class="btn">Archive</button>
            </div>
            <button id="enter-hall-btn" class="btn" style="border-color: #666; color: #fff; margin-top: 5px;">
                Enter Hall <span id="memory-count" style="opacity:0.6; font-size:9px; margin-left:5px;">(0)</span>
            </button>
        </div>

        <!-- å±•é¤¨å°èˆª -->
        <div id="gallery-ui" class="hidden">
                        <button id="back-btn" class="btn" style="position:absolute; top:30px; left:30px; width:auto; padding:10px 25px; z-index:200;">&larr; Workstation</button>
                        <div class="nav-zone left" id="prev-zone"><div class="arrow">&larr;</div></div>
                        <div class="nav-zone right" id="next-zone"><div class="arrow">&rarr;</div></div>
            <div id="gallery-info">
                <div id="gallery-counter">MEMORY 01</div>
                <div style="font-size: 10px; opacity: 0.6; letter-spacing: 2px;">AFTERGLOW ARCHIVE</div>
            </div>
        </div>
    </div>

    <div id="canvas-container"></div>

    <script type="module" src="/src/main.js"></script>
</body>
</html>
